<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard - PasteLink.site</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <header class="navbar">
    <div class="logo">PasteLink.site</div>
    <button class="menu-toggle" onclick="toggleMenu()">‚ò∞</button>
    <nav class="nav-links" id="menu">
      <!-- Diisi otomatis oleh setupNavbar -->
    </nav>
  </header>

  <main class="container">
    <h2>Riwayat paste kamu</h2>
    <div id="pasteList">
      <p>Sedang memuat data paste...</p>
    </div>
  </main>

  <footer class="footer">
    ¬© 2025 PasteLink.site All rights reserved.
  </footer>

  <script>
    const supabase = window.supabase.createClient(
      'https://lkwanssplddqrpgxaxft.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxrd2Fuc3NwbGRkcXJwZ3hheGZ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2MzE0NzYsImV4cCI6MjA3MjIwNzQ3Nn0.6Ye2wuz4ICmyZL3ObGjMXlsr3di4mUEdMV0y3lhawQY'
    );

    async function logout() {
      await supabase.auth.signOut();
      location.href = 'login.html';
    }

    function toggleMenu() {
      document.getElementById("menu").classList.toggle("active");
    }

    async function setupNavbar() {
      const { data: { session } } = await supabase.auth.getSession();
      const menu = document.getElementById("menu");
      if (session) {
        menu.innerHTML = `
          <a href="index.html">Beranda</a>
          <a href="buat.html">Buat Postingan</a>
          <a href="dashboard.html">Akun Saya</a>
          <a href="terbaru.html">Terbaru</a>
          <a href="trending.html">Trending</a>
          <button onclick="logout()" class="logout-btn">Logout</button>
          <button onclick="toggleDarkMode()" id="darkToggle" class="logout-btn">üåô</button>
        `;
      } else {
        location.href = 'login.html';
      }
      updateDarkToggleIcon();
    }

    function toggleDarkMode() {
      const isDark = document.body.classList.toggle('dark-mode');
      localStorage.setItem('dark-mode', isDark ? 'true' : 'false');
      updateDarkToggleIcon();
    }

    function updateDarkToggleIcon() {
      const btn = document.getElementById("darkToggle");
      if (btn) btn.textContent = document.body.classList.contains("dark-mode") ? "‚òÄÔ∏è" : "üåô";
    }

    (function loadDarkMode() {
      if (localStorage.getItem('dark-mode') === 'true') {
        document.body.classList.add('dark-mode');
      }
    })();

    async function loadPastes() {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return (location.href = 'login.html');

      const { data, error } = await supabase
        .from('pastes')
        .select('id, created_at')
        .eq('user_id', user.id)
        .order('created_at', { ascending: false });

      const list = document.getElementById('pasteList');
      if (error || !data.length) {
        list.innerHTML = `<p>Tidak ada paste ditemukan.</p>`;
        return;
      }

      list.innerHTML = '<ul style="list-style:none; padding:0;">' + data.map(paste => `
        <li style="margin-bottom: 12px; border:1px solid #ccc; padding:12px; border-radius:8px;">
          <strong>${paste.id}</strong><br>
          <small>Dibuat: ${new Date(paste.created_at).toLocaleString()}</small><br><br>
          <button class="dashboard-btn view" onclick="lihatPaste('${paste.id}')">üëÅÔ∏è Lihat</button>
          <button class="dashboard-btn delete" onclick="hapusPaste('${paste.id}')">üóëÔ∏è Hapus</button>
        </li>
      `).join('') + '</ul>';
    }

    function lihatPaste(id) {
      window.open(`redirect.html#${id}`, '_blank');
    }

    async function hapusPaste(id) {
      const konfirmasi = confirm("Yakin mau hapus paste ini?");
      if (!konfirmasi) return;

      const { error } = await supabase.from('pastes').delete().eq('id', id);
      if (error) return alert("‚ùå Gagal menghapus");
      alert("‚úÖ Paste berhasil dihapus!");
      loadPastes();
    }

    setupNavbar();
    loadPastes();
  </script>
</body>
</html>
